# 浮点数表达式计算

## 格式规范

- 字符集为 `0123456789.eE+-*/` 以及空格
- 总长度不能超过 $10%5$
- 数字需要以科学记数法的形式给出

  - 可以有前导零
  - 小数点前如果是0可以省略
  - 若存在小数点，则小数点后必须有数字
  - 指数部分不能出现小数
  - 若存在指数部分标识符E或e，则指数部分必须存在
  - 可在整个数字前面或者指数部分的前面添加一个正号或负号
- 举例子：

  - `3` 合法
  - `000` 合法
  - `0.0` 合法
  - `.123` 合法
  - `1.23` 合法
  - `00.123` 合法
  - `123.456E+8` 合法
  - `-234.345e-88` 合法
  - `+.001E0` 合法
  - `3.4E9.8` 不合法，因为指数部分不能出现小数
  - `3.` 不合法，因为不是一个严格的数字
  - `3E` 不合法，因为不是一个严格的数字
- 算式必须以完全标准的形式给出，即：

  - 括号必须匹配
  - 不能有相邻的双目算符
  - 数字不能相邻
  - 数字不能紧跟右括号，左括号不能紧跟数字，左括号不能紧跟右括号
  - 乘除号的左右两边必须是数字或者完整的括号表达式
  - 加减号在作为数字前的取反标识符时，左侧可以不与数字或完整的括号表达式相邻，反之左右两边必须与数字或者完整的括号表达式相邻
  - 除号右侧的数字或者括号表达式的值必须非0
  - 一对括号内的内容不能为空

## 代码细节

本程序在 Linux 下可编译运行，按照 c++11 标准编写。

在读入数字的过程中，本程序使用了一个有限状态自动机。读取一个科学记数法表示的数字的过程可以分为9个阶段：
$$
\overbrace{\pm}^{1} \overbrace{12345}^2\overbrace{.}^3\overbrace{12345}^{4}\overbrace{E}^5\overbrace{\pm}^6\overbrace{12345}^7 \overbrace{(EOF)}^{8}
$$
这 9 个阶段对应了有限状态自动机的 9 个状态，根据每个状态下读入到的字符，有限状态自动机会发生对应的转移。转移的最终结果有两种：

- 达到8号状态，代表读取到了一个合法的数字
- 达到非法状态，代表数字有问题

当读取数字达到一个非法状态时，程序将会抛出异常，最终显示出是第几个字符导致的异常，来达到错误定位的目的。

在计算表达式的值的时候，本程序使用了一个栈。在遇到非法情况，如弹出空栈，遇到相邻两个算符等问题时，程序也将抛出异常，最终显示出是第几个字符导致的异常，来达到错误定位的目的。

如果整个计算过程未发生异常，则会返回一个保留了两位小数的实数，表示答案。

## 异常代码

- `Illegal Character Id` ：第 Id 个字符不在规定的字符集内
- `Illegal Number Id` ：第 Id 个字符使得读入数字的有限状态自动机进入非法状态
- `Operand With Only One or Less Parameter Id` ：第 Id 个字符使得算式中的某个双目算符只有一个或零个参数
- `Division by 0 Id` ：第 Id 个字符使得算式中出现了除以 0 的错误
- `Illegal Combination of Operands Id` ：第 Id 个字符使得算式中出现了相邻的双目算符
- `Brackets Enclosing Nothing Id` ：第 Id 个字符使得算式中出现了空的括号对
- `Unpaired Left Bracket Id` ：第 Id 个字符使得算式中出现了单独的左括号
- `Unpaired Right Bracket Id` ：第 Id 个字符使得算式中出现了单独的右括号
- `Adjacent Brackets Id` ：第 Id 个字符使得算式中出现了左括号紧跟右括号的情况
- `Brackets Followed by a Single Number Id` ：第 Id 个字符使得算式中出现了数字紧跟右括号的情况
- `Number Followed by a Left Bracket Id` ：第 Id 个字符使得算式中出现了左括号紧跟数字的情况
- `Adjacent Numbers Id` ：第 Id 个字符使得算式中出现了两个数字相邻的情况
- `Expression Length Exceeded` ：算式总长度过长，超过了 $10%5$ 的上限